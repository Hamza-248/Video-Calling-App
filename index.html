<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Hobe's Chat</title>
	<link rel="icon" href="https://img.icons8.com/?size=100&id=AdGFBgNgeWDp&format=png&color=000000"
		type="image/x-icon">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.5.4/peerjs.min.js"></script>
	<style>
		:root {
			--primary-blue: #0072ff;
			--dark-bg: #1f2024;
			--medium-bg: #282a30;
			--light-text: #e0e0e0;
			--red-accent: #e74c3c;
		}

		@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

		:root {
			--primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			--secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
			--success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
			--danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);

			--bg-primary: #0a0b0d;
			--bg-secondary: #151619;
			--bg-tertiary: #1e1f23;
			--bg-card: #252730;
			--bg-glass: rgba(37, 39, 48, 0.8);

			--text-primary: #ffffff;
			--text-secondary: #b4b6c1;
			--text-tertiary: #868b9a;

			--border-primary: rgba(255, 255, 255, 0.1);
			--border-secondary: rgba(255, 255, 255, 0.05);

			--shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.12);
			--shadow-md: 0 8px 24px rgba(0, 0, 0, 0.15);
			--shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.25);
			--shadow-xl: 0 24px 64px rgba(0, 0, 0, 0.35);

			--radius-sm: 8px;
			--radius-md: 12px;
			--radius-lg: 16px;
			--radius-xl: 24px;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: var(--bg-primary);
			color: var(--text-primary);
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
			padding: 1rem;
			overflow: hidden;
			position: relative;
		}

		body::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background:
				radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
				radial-gradient(circle at 80% 20%, rgba(118, 75, 162, 0.1) 0%, transparent 50%),
				radial-gradient(circle at 40% 80%, rgba(240, 147, 251, 0.08) 0%, transparent 50%);
			pointer-events: none;
			z-index: -1;
		}

		.container {
			background: var(--bg-glass);
			backdrop-filter: blur(24px) saturate(180%);
			border-radius: var(--radius-xl);
			padding: 3rem;
			box-shadow: var(--shadow-xl);
			border: 1px solid var(--border-primary);
			width: 100%;
			max-width: 1000px;
			transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
			overflow: hidden;
		}

		.container::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 1px;
			background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.2) 50%, transparent 100%);
		}

		h1 {
			text-align: center;
			margin-bottom: 2.5rem;
			font-size: 2.5rem;
			font-weight: 700;
			background: var(--primary-gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
			letter-spacing: -0.02em;
		}

		/* --- LOBBY / SETUP SECTION --- */
		.lobby {
			display: flex;
			gap: 3rem;
			align-items: flex-start;
		}

		.lobby-preview {
			flex: 1;
			display: flex;
			flex-direction: column;
			align-items: center;
		}

		.preview-video-wrapper {
			width: 100%;
			aspect-ratio: 16/9;
			background: var(--bg-secondary);
			border-radius: var(--radius-lg);
			overflow: hidden;
			margin-bottom: 1.5rem;
			position: relative;
			border: 1px solid var(--border-secondary);
			box-shadow: var(--shadow-md);
		}

		.preview-video-wrapper video {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		@media only screen and (max-width: 768px) {
			.lobby {
				align-items: center;
			}
		}

		.preview-video-wrapper::after {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: linear-gradient(45deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
			pointer-events: none;
			opacity: 0;
			transition: opacity 0.3s ease;
		}

		.preview-video-wrapper:hover::after {
			opacity: 1;
		}

		.lobby-controls {
			flex: 1;
			display: flex;
			flex-direction: column;
			gap: 2rem;
		}

		.control-group {
			background: var(--bg-card);
			padding: 2rem;
			border-radius: var(--radius-lg);
			border: 1px solid var(--border-secondary);
			position: relative;
			transition: all 0.3s ease;
		}

		.control-group:hover {
			border-color: var(--border-primary);
			transform: translateY(-2px);
			box-shadow: var(--shadow-lg);
		}

		.control-group h3 {
			margin-bottom: 1.5rem;
			text-align: center;
			font-weight: 600;
			font-size: 1.1rem;
			color: var(--text-primary);
			letter-spacing: -0.01em;
		}

		.button-group {
			display: flex;
			gap: 1rem;
			justify-content: center;
		}

		input[type="text"] {
			padding: 1rem 1.5rem;
			border: 1px solid var(--border-primary);
			border-radius: var(--radius-md);
			background: var(--bg-tertiary);
			color: var(--text-primary);
			font-size: 1rem;
			width: 100%;
			text-align: center;
			transition: all 0.3s ease;
			font-family: 'Inter', sans-serif;
		}

		input[type="text"]:focus {
			outline: none;
			border-color: transparent;
			box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.4);
			background: var(--bg-secondary);
		}

		input[type="text"]::placeholder {
			color: var(--text-tertiary);
		}

		button {
			padding: 1rem 2rem;
			border: none;
			border-radius: var(--radius-md);
			background: var(--primary-gradient);
			color: white;
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 0.5rem;
			position: relative;
			overflow: hidden;
			font-family: 'Inter', sans-serif;
			letter-spacing: -0.01em;
		}

		button::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100%;
			width: 100%;
			height: 100%;
			background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
			transition: left 0.5s;
		}

		button:hover::before {
			left: 100%;
		}

		button:hover {
			transform: translateY(-3px);
			box-shadow: var(--shadow-lg);
		}

		button:disabled {
			opacity: 0.6;
			cursor: not-allowed;
			transform: none;
		}

		button:disabled:hover::before {
			left: -100%;
		}

		/* --- CONNECTION INFO --- */
		.connection-info {
			text-align: center;
			display: none;
		}

		.share-box {
			background: var(--bg-card);
			padding: 2rem;
			border-radius: var(--radius-lg);
			margin-top: 1.5rem;
			border: 1px solid var(--border-secondary);
		}

		.share-id,
		.share-link {
			background: var(--bg-tertiary);
			padding: 1.5rem;
			border-radius: var(--radius-md);
			margin: 1rem 0 1.5rem 0;
			word-break: break-all;
			font-family: 'JetBrains Mono', 'Fira Code', monospace;
			font-size: 0.9rem;
			border: 1px solid var(--border-secondary);
			color: var(--text-secondary);
		}

		.copy-btn {
			background: var(--bg-tertiary);
			border: 1px solid var(--border-primary);
			position: relative;
			font-size: 0.9rem;
			padding: 0.75rem 1.5rem;
		}

		.copy-btn:hover {
			background: var(--success-gradient);
			border-color: transparent;
		}

		.copy-feedback {
			position: absolute;
			top: -40px;
			left: 50%;
			transform: translateX(-50%);
			background: var(--success-gradient);
			color: white;
			padding: 8px 16px;
			border-radius: var(--radius-sm);
			font-size: 0.8em;
			opacity: 0;
			transition: all 0.3s ease;
			white-space: nowrap;
			box-shadow: var(--shadow-md);
		}

		/* --- VIDEO CALL VIEW --- */
		.video-call-view {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100vw;
			height: 100vh;
			background: var(--bg-primary);
			z-index: 1000;
		}

		.video-wrapper {
			position: absolute;
			overflow: hidden;
			background: var(--bg-secondary);
			transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
		}

		.remote-video-wrapper {
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}

		.local-video-wrapper {
			width: clamp(160px, 22vw, 320px);
			aspect-ratio: 16/9;
			border-radius: var(--radius-lg);
			border: 2px solid rgba(255, 255, 255, 0.3);
			box-shadow: var(--shadow-xl);
			z-index: 1002;
			cursor: grab;
			bottom: 2rem;
			right: 2rem;
			backdrop-filter: blur(8px);
		}

		.local-video-wrapper.dragging {
			cursor: grabbing;
			box-shadow: var(--shadow-xl), 0 0 0 4px rgba(102, 126, 234, 0.3);
		}

		video {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}

		.video-status-overlay {
			position: absolute;
			top: 12px;
			right: 12px;
			display: flex;
			gap: 0.5rem;
			z-index: 1003;
		}

		.status-icon {
			background: rgba(0, 0, 0, 0.7);
			backdrop-filter: blur(8px);
			width: 40px;
			height: 40px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			border: 1px solid rgba(255, 255, 255, 0.1);
		}

		.status-icon svg {
			width: 25px;
			height: 25px;
			fill: white;
		}

		/* --- IN-CALL CONTROLS --- */
		.call-controls {
			display: none;
			/* JS will show this */
			position: absolute;
			bottom: 2.5rem;
			left: 50%;
			transform: translateX(-50%);
			z-index: 1003;
			background: rgba(40, 42, 48, 0.6);
			backdrop-filter: blur(12px) saturate(180%);
			padding: 0.75rem;
			border-radius: 50px;
			display: flex;
			flex-shrink: 0;
			gap: 0.75rem;
			border: 1px solid rgba(255, 255, 255, 0.15);
			box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
		}

		.control-btn {
			width: 50px;
			height: 50px;
			padding: 0;
			border-radius: 50%;
			background: rgba(255, 255, 255, 0.1);
			color: #f0f0f0;
			transition: all 0.2s ease-in-out;
		}

		.control-btn.active {
			background: rgba(255, 255, 255, 0.2);
		}

		.control-btn.end-call {
			background: var(--red-accent);
		}

		.control-btn svg {
			width: 24px;
			height: 24px;
			fill: white;
		}

		.control-btn:hover:not(.end-call) {
			background: rgba(255, 255, 255, 0.2);
			transform: translateY(-2px);
		}

		.control-btn.end-call:hover {
			filter: brightness(1.2);
			transform: translateY(-2px);
		}

		/* --- STATUS MESSAGES --- */
		.status {
			text-align: center;
			padding: 1rem;
			border-radius: 10px;
			margin: 1rem auto;
			font-weight: 500;
			max-width: 80%;
			display: none;
			border: 1px solid transparent;
			transition: all 0.3s ease;
		}

		.status.waiting {
			background: rgba(255, 193, 7, 0.15);
			color: #ffc107;
			border-color: #ffc107;
		}

		.status.connected {
			background: rgba(40, 167, 69, 0.15);
			color: #28a745;
			border-color: #28a745;
		}

		.status.error {
			background: rgba(220, 53, 69, 0.15);
			color: #dc3545;
			border-color: #dc3545;
		}

		.status.info {
			background: rgba(23, 162, 184, 0.15);
			color: #17a2b8;
			border-color: #17a2b8;
		}

		.loading {
			display: inline-block;
			width: 20px;
			height: 20px;
			border: 3px solid rgba(255, 255, 255, .3);
			border-radius: 50%;
			border-top-color: #fff;
			animation: spin 1s ease-in-out infinite;
		}

		@keyframes spin {
			to {
				transform: rotate(360deg);
			}
		}

		@media (max-width: 768px) {
			.lobby {
				flex-direction: column;
			}

			.container {
				padding: 1rem;
			}

			h1 {
				font-size: 1.8rem;
			}

			.local-video-wrapper {
				bottom: 8rem;
			}

			.call-controls {
				width: 95%;
				bottom: 1.5rem;
			}
		}
	</style>
</head>

<body>
	<!-- SVG Icons Definition -->
	<svg width="0" height="0" style="display:none;">
		<symbol id="icon-mic" viewBox="0 0 24 24">
			<path
				d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1.2-9.1c0-.66.54-1.2 1.2-1.2.66 0 1.2.54 1.2 1.2l-.01 6.2c0 .66-.53 1.2-1.19 1.2s-1.2-.54-1.2-1.2V4.9zm6.5 6.1c0 3.03-2.47 5.5-5.5 5.5S6.5 14.03 6.5 11H5c0 3.53 2.84 6.4 6.25 6.92V21h1.5v-3.08c3.41-.52 6.25-3.39 6.25-6.92h-1.5z" />
		</symbol>
		<symbol id="icon-mic-off" viewBox="0 0 24 24">
			<path
				d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18l5.82 5.82H15v-1c0-1.66-1.34-3-3-3s-3 1.34-3 3v.18l-2-2V5c0-1.66 1.34-3 3-3s3 1.34 3 3v6c0 1.66-1.34 3-3 3-.85 0-1.6-.35-2.14-.9l-1.46 1.46C9.23 15.48 10.53 16 12 16c2.76 0 5-2.24 5-5h-1.5c0 2.21-1.79 4-4 4s-4-1.79-4-4H5c0 3.53 2.84 6.4 6.25 6.92V21h1.5v-3.08c.5-.08 1-.21 1.48-.4l-1.46-1.46C12.63 16.04 12.32 16.05 12 16c-2.21 0-4-1.79-4-4H5c0 .3.02.6.06.89l-1.63 1.63C3.18 12.01 3 11.51 3 11h1.5c0 2.21 1.79 4 4 4 .78 0 1.5-.22 2.11-.6l1.43 1.43c-.57.34-1.21.57-1.9.65v2.02h1.5v-2.02c3.41-.52 6.25-3.39 6.25-6.92h-1.5c0 .02 0 .03 0 .05l-1.43-1.43c.22-.61.33-1.26.33-1.95V5c0-.26-.02-.52-.06-.77l-2 2V11c0 1.66-1.34 3-3 3s-3-1.34-3-3v-2.18l-2-2V11c0 1.66 1.34 3 3 3s3-1.34 3-3V5c0-.26-.02-.52-.06-.77l-2 2V11c0 .02 0 .03 0 .05zM4.27 3L3 4.27l6.01 6.01L9 10.28V11c0 1.66 1.34 3 3 3s3-1.34 3-3V5c0-.26-.02-.52-.06-.77L19.73 21 21 19.73 4.27 3z" />
		</symbol>
		<symbol id="icon-video" viewBox="0 0 24 24">
			<path
				d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z" />
		</symbol>
		<symbol id="icon-video-off" viewBox="0 0 24 24">
			<path
				d="M21 6.5l-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18V6.5zM3.27 2L2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.27L19.73 21 21 19.73 3.27 2z" />
		</symbol>
		<symbol id="icon-hangup" viewBox="0 0 24 24">
			<path
				d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.26 0-.51-.1-.7-.29l-.71-.7c-.18-.18-.29-.43-.29-.7 0-.28.11-.53.29-.71C5.32 10.5 8.51 9 12 9s6.68 1.5 8.93 3.15c.18.18.29.43.29.71 0 .27-.11.52-.29.7l-.71.7c-.18.19-.44.29-.7.29-.27 0-.52-.1-.7-.28-.79-.73-1.68-1.36-2.66-1.85-.33-.16-.56-.51-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z" />
		</symbol>
	</svg>

	<div class="container" id="mainContainer">
		<h1>Hobe's Proprietary Video Chat</h1>

		<div id="status" class="status"></div>

		<div id="setupSection">
			<div class="lobby">
				<div class="lobby-preview">
					<div class="preview-video-wrapper">
						<video id="previewVideo" autoplay muted playsinline></video>
					</div>
				</div>
				<div class="lobby-controls">
					<div class="control-group">
						<h3>Create a New Call</h3>
						<div class="button-group">
							<button onclick="startHost()" id="hostBtn">Start Call</button>
						</div>
					</div>
					<div class="control-group">
						<h3>Join with an ID</h3>
						<input type="text" id="peerIdInput" placeholder="Enter Peer ID to connect">
						<div class="button-group" style="margin-top: 1rem;">
							<button onclick="connectToPeer()" id="connectBtn">Join Call</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div id="connectionInfo" class="connection-info">
			<h3>Waiting for others to join...</h3>
			<p style="opacity: 0.7; margin-bottom: 1rem;">Share this info to start the video chat:</p>
			<div class="share-box">
				<div>
					<strong>Peer ID:</strong>
					<div id="peerIdDisplay" class="share-id">Generating...</div>
					<button class="copy-btn" onclick="copyToClipboard('peerIdDisplay', this)">Copy ID</button>
				</div>
				<div style="margin-top: 1.5rem;">
					<strong>Direct Link:</strong>
					<div id="shareLink" class="share-link">Generating...</div>
					<button class="copy-btn" onclick="copyToClipboard('shareLink', this)">Copy Link</button>
				</div>
			</div>
		</div>
	</div>

	<div id="videoCallView" class="video-call-view">
		<div class="video-wrapper remote-video-wrapper">
			<video id="remoteVideo" autoplay playsinline></video>
		</div>
		<div class="video-wrapper local-video-wrapper" id="localVideoWrapper">
			<video id="localVideo" autoplay muted playsinline></video>
			<div class="video-status-overlay" id="localVideoStatus"></div>
		</div>
		<div class="call-controls" id="callControls">
			<button class="control-btn" id="muteBtn" onclick="toggleMute()">
				<svg>
					<use xlink:href="#icon-mic"></use>
				</svg>
			</button>
			<button class="control-btn" id="videoBtn" onclick="toggleVideo()">
				<svg>
					<use xlink:href="#icon-video"></use>
				</svg>
			</button>
			<button class="control-btn end-call" onclick="endCall()">
				<svg style="width: 32px; height: 32px;">
					<use xlink:href="#icon-hangup"></use>
				</svg>
			</button>
		</div>
	</div>

	<script>
		// Global variables
		let peer = null;
		let localStream = null;
		let currentCall = null;
		let isHost = false;
		let isMuted = false;
		let isVideoOff = false;

		// Initialize PeerJS
		function initializePeer() {
			return new Promise((resolve, reject) => {
				// Create peer with random ID
				peer = new Peer({
					config: {
						iceServers: [
							{ urls: 'stun:stun.l.google.com:19302' },
							{ urls: 'stun:stun1.l.google.com:19302' },
							{ urls: 'stun:stun.relay.metered.ca:80' }
						]
					}
				});

				peer.on('open', (id) => {
					console.log('Peer ID:', id);
					resolve(id);
				});

				peer.on('error', (error) => {
					console.error('Peer error:', error);
					reject(error);
				});

				// Handle incoming calls
				peer.on('call', (call) => {
					updateStatus('ðŸ“ž Incoming call...', 'info');

					// Answer the call with our stream
					if (localStream) {
						call.answer(localStream);
						handleCall(call);
					} else {
						setupMedia().then(() => {
							call.answer(localStream);
							handleCall(call);
						}).catch(err => {
							updateStatus('Failed to access camera/microphone', 'error');
							call.close();
						});
					}
				});

				peer.on('disconnected', () => {
					updateStatus('Disconnected from signaling server', 'error');
				});

				peer.on('close', () => {
					updateStatus('Connection closed', 'error');
				});
			});
		}

		async function startHost() {
			try {
				document.getElementById('hostBtn').innerHTML = '<span class="loading"></span> Starting...';
				document.getElementById('hostBtn').disabled = true;

				// Initialize peer connection
				const peerId = await initializePeer();

				// Setup media
				await setupMedia();

				// Show connection info
				isHost = true;
				document.getElementById('peerIdDisplay').textContent = peerId;
				const shareUrl = `${window.location.origin}${window.location.pathname}?connect=${peerId}`;
				document.getElementById('shareLink').textContent = shareUrl;

				document.getElementById('setupSection').style.display = 'none';
				document.getElementById('connectionInfo').style.display = 'block';
				document.getElementById('hostInfo').style.display = 'block';

				updateStatus('ðŸŽ¯ Ready! Share your Peer ID or link to start video chat', 'waiting');

			} catch (error) {
				console.error('Error starting host:', error);
				updateStatus('Failed to start: ' + error.message, 'error');
				document.getElementById('hostBtn').innerHTML = 'ðŸŽ¥ Start Video Chat';
				document.getElementById('hostBtn').disabled = false;
			}
		}

		async function connectToPeer() {
			const peerIdToConnect = document.getElementById('peerIdInput').value.trim();

			if (!peerIdToConnect) {
				alert('Please enter a Peer ID');
				return;
			}

			try {
				document.getElementById('connectBtn').innerHTML = '<span class="loading"></span> Connecting...';
				document.getElementById('connectBtn').disabled = true;

				// Initialize our peer
				await initializePeer();

				// Setup media
				await setupMedia();

				// Make the call
				const call = peer.call(peerIdToConnect, localStream);
				handleCall(call);

				document.getElementById('setupSection').style.display = 'none';
				updateStatus('ðŸ“ž Calling peer...', 'waiting');

			} catch (error) {
				console.error('Error connecting:', error);
				updateStatus('Failed to connect: ' + error.message, 'error');
				document.getElementById('connectBtn').innerHTML = 'ðŸ“ž Connect';
				document.getElementById('connectBtn').disabled = false;
			}
		}

		function handleCall(call) {
			currentCall = call;

			call.on('stream', (remoteStream) => {
				document.getElementById('remoteVideo').srcObject = remoteStream;
				updateStatus('ðŸŽ‰ Connected! Enjoy your video chat', 'connected');

				// Hide connection info, show video
				document.getElementById('connectionInfo').style.display = 'none';
				document.getElementById('videoContainer').style.display = 'grid';
				document.getElementById('controls').style.display = 'flex';
			});

			call.on('close', () => {
				updateStatus('ðŸ“´ Call ended', 'error');
				document.getElementById('remoteVideo').srcObject = null;
				endCall();
			});

			call.on('error', (error) => {
				console.error('Call error:', error);
				updateStatus('Call error: ' + error.message, 'error');
			});
		}

		async function setupMedia() {
			try {
				// Check if we're on HTTPS or localhost
				const isSecure = location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';

				if (!isSecure) {
					throw new Error('HTTPS or localhost required for camera access');
				}

				localStream = await navigator.mediaDevices.getUserMedia({
					video: {
						width: { ideal: 1280 },
						height: { ideal: 720 }
					},
					audio: {
						echoCancellation: true,
						noiseSuppression: true,
						autoGainControl: true
					}
				});

				document.getElementById('localVideo').srcObject = localStream;

			} catch (error) {
				console.error('Error accessing media:', error);

				let errorMessage = 'Camera/microphone error: ';
				if (error.name === 'NotAllowedError') {
					errorMessage += 'Permission denied. Please allow access and refresh.';
				} else if (error.name === 'NotFoundError') {
					errorMessage += 'No camera/microphone found.';
				} else if (error.message.includes('HTTPS')) {
					errorMessage += 'HTTPS required. Please use https:// or localhost';
				} else {
					errorMessage += error.message;
				}

				throw new Error(errorMessage);
			}
		}

		function updateStatus(message, type) {
			const statusEl = document.getElementById('status');
			statusEl.textContent = message;
			statusEl.className = `status ${type}`;
			statusEl.style.display = 'block';
		}

		function copyPeerId() {
			const peerId = document.getElementById('peerIdDisplay').textContent;
			navigator.clipboard.writeText(peerId).then(() => {
				alert('Peer ID copied! Share this with the person you want to video chat with.');
			});
		}

		function copyLink() {
			const link = document.getElementById('shareLink').textContent;
			navigator.clipboard.writeText(link).then(() => {
				alert('Link copied! Send this to anyone to start video chat instantly.');
			});
		}

		function toggleMute() {
			if (localStream) {
				const audioTrack = localStream.getAudioTracks()[0];
				if (audioTrack) {
					audioTrack.enabled = !audioTrack.enabled;
					isMuted = !audioTrack.enabled;
					document.getElementById('muteBtn').textContent = isMuted ? 'ðŸ”‡ Unmute' : 'ðŸŽ¤ Mute';
				}
			}
		}

		function toggleVideo() {
			if (localStream) {
				const videoTrack = localStream.getVideoTracks()[0];
				if (videoTrack) {
					videoTrack.enabled = !videoTrack.enabled;
					isVideoOff = !videoTrack.enabled;
					document.getElementById('videoBtn').textContent = isVideoOff ? 'ðŸ“¹ Video On' : 'ðŸ“¹ Video Off';
				}
			}
		}

		function endCall() {
			if (currentCall) {
				currentCall.close();
				currentCall = null;
			}

			if (localStream) {
				localStream.getTracks().forEach(track => track.stop());
				localStream = null;
			}

			if (peer) {
				peer.disconnect();
				peer.destroy();
				peer = null;
			}

			// Reset and reload
			location.window.href = "https://hamza-248.github.io/Video-Calling-App/";
		}

		// Handle direct connection via URL parameter
		window.addEventListener('load', () => {
			const urlParams = new URLSearchParams(window.location.search);
			const connectTo = urlParams.get('connect');

			if (connectTo) {
				document.getElementById('peerIdInput').value = connectTo;
				// Auto-connect after a brief delay
				setTimeout(() => {
					connectToPeer();
				}, 500);
			}
		});

		// Cleanup on page unload
		window.addEventListener('beforeunload', () => {
			if (currentCall) {
				currentCall.close();
			}
			if (peer) {
				peer.disconnect();
				peer.destroy();
			}
		});
	</script>
</body>

</html>
